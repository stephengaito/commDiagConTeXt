% A ConTeXt document [master document: commdiag.tex]

\startchapter[title=Preamble]

\startMkIVCode
%D \module
%D   [     file=t-commdiag,
%D      version=2018.08.07,
%D        title=\CONTEXT\ User module,
%D     subtitle=Commutative Diagrams for \ConTeXt\,
%D       author=Stephen Gaito,
%D         date=\currentdate,
%D    copyright=PerceptiSys Ltd (Stephen Gaito),
%D        email=stephen@perceptisys.co.uk,
%D      license=MIT License]

% begin info
%
% title   : Commutative Diagrams for ConTeXt
% comment : Provides structured document and code generation
% status  : under development, mkiv only
%
% end info

% the following IMMEDIATELY loads our t-commdiag.mpiv file into EVERY 
% instance which allows extensions 
%
%\startMPextensions
%  input t-commdiag.mpiv
%\stopMPextensions

% the following (dealayed) loads our t-commdiag.mpiv file into ONLY the 
% metafun (default) instance. 
%
\startMPdefinitions {metafun}
    if unknown commdiag_macros : input t-commdiag.mpiv ; fi ;
\stopMPdefinitions

\stopMkIVCode

\startMkIVCode
\usemodule[literate-progs]

\unprotect

\ctxloadluafile{t-commdiag}
\stopMkIVCode

\startMpIVCode
%D \module
%D   [     file=t-commdiag,
%D      version=2018.08.07,
%D        title=\CONTEXT\ User module,
%D     subtitle=Commutative Diagrams for \ConTeXt\,
%D       author=Stephen Gaito,
%D         date=\currentdate,
%D    copyright=PerceptiSys Ltd (Stephen Gaito),
%D        email=stephen@perceptisys.co.uk,
%D      license=MIT License]

% begin info
%
% title   : Commutative Diagrams for ConTeXt
% comment : Provides structured document and code generation
% status  : under development, mkiv only
%
% end info

if known commdiag_macros : endinput ; fi ;

boolean commdiag_macros ; commdiag_macros := true ;

\stopMpIVCode

\startLuaCode
-- This is the lua code associated with t-commdiag.mkiv

if not modules then modules = { } end modules ['t-commdiag'] = {
    version   = 1.000,
    comment   = "Commutative Diagrams for ConTeXt - lua",
    author    = "PerceptiSys Ltd (Stephen Gaito)",
    copyright = "PerceptiSys Ltd (Stephen Gaito)",
    license   = "MIT License"
}

thirddata            = thirddata          or {}
thirddata.commdiag   = thirddata.commdiag or {}

local commdiag       = thirddata.commdiag
\stopLuaCode

\stopchapter
