% A ConTeXt document [master document: commdiag.tex]

\startchapter[title=Overview]

This document defines the Commutative Diagrams for \ConTeXt\ module, 
\type{t-commdiag}. This module provides (Mathematical) Commutative 
Diagrams using \ConTeXt's underlying MetaPost/MetaFun graphics primitives. 

This document uses the \type{t-literate-modules} \ConTeXt\ module to 
define the \type{t-commdiag} module. This means that the code required to 
implement the Commutative Diagrams module is an integral part of this document. 

As far as the \type{t-commdiag} module is concerned, a commutative diagram 
is a collection of \quote{objects} laid out in a (rectangular) martix, 
together with a collection of \quote{arrows} between pairs of 
\quote{objects}. The label for a given object is typically typeset using 
\ConTeXt\ and is then drawn in the appropriate location in the matrix. 
Each arrow can be drawn with a number of arrow bodies, as well as arrow 
heads and/or tails. Each arrow can also have a label, again typeset in 
\ConTeXt. 

To \emph{use} the \type{t-commdiag} module, you need to \type{use} the 
\type{t-commdiag} module in the \quote{usual} \ConTeXt\ way: 

\starttyping
\usemodule[t-commdiag]
\stoptyping

\noindent\ This \type{\usemodule} statement must occur in the document's 
setup section.

\startbuffer
\startformula \startMPcode{commDiag}  
  setupCommDiags ; 
  
  addObject(1,1, "X_0");
  addObject(1,2, "X_1");
  
  addObject(2,1, "Y_0");
  addObject(2,2, "Y_1");

  drawObjects(1.75cm, 2cm);

  addArrow(1,1, 1,2, ">", 0)()()("j_0",     0.5, top);
  addArrow(1,1, 2,1, ">", 0)()()("k_0",     0.5, lft);
  addArrow(1,2, 2,2, ">", 0)()()("k_1",     0.5, rt);
  addArrow(2,1, 2,2, ">", 0)()()("t_1",     0.5, bot);
\stopMPcode \stopformula
\stopbuffer

As a simple example, consider the following square commutative diagram: 
\processTEXbuffer

\noindent\ It was created using the following \type{t-commdiag} code:

\typebuffer

A typical \type{t-commdiag} diagram's code has five sections:

\startitemize[n]

\item {\bf The \type{setupComDiags} statement.} The \type{setupCommDiags} 
statement sets up the \type{objLabel}, and \type{w} matrices, as well as 
the \type{numRows} and \type{numCols} variables. These \type{objLabel} and 
\type{w} matrices are used by the \type{addObject} and \type{addArrow} 
statements, to correctly align the objects and arrows of the commutative 
diagram.

\item {\bf A collection of \type{addObject} statements.}

\item {\bf The \type{drawObjects} statement.} The two arguments to the 
\type{drawObjects} statement, are the row height, and column width 
respectively. You can use these two parameters to adjust the overall size 
of your diagram. The \type{drawObjects} statement sets the locations of 
all of the object labels and then draws them. You can use these object 
labels or object positions in your own MetaPost/MetaFun code. 

\item {\bf A collection of \type{addArrow} statements.}

\item {\bf Optionally, your own MetaPost/MetaFun code.} If for some reason 
the \type{t-commdiag} primitives are not sufficient for your needs, you 
are able to use the \type{objLabel} and \type{w} matrices in your 
arbitrary MetaPost/MetaFun code. However your own code \emph{must} be 
located \emph{after} the \type{drawObjects} statement, and preferably 
after all \type{addArrow} statements. 

\stopitemize

\noindent\ The order of these four sections is \emph{critical}, they will 
not work in any other order.

\stopchapter 